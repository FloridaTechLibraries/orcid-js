<!-- Example that creates orcid.bib file and downloads it -->

<script src='swagger-js/browser/swagger-client.js' type='text/javascript'></script>
<script src='citeproc-js/xmle4x.js' type='text/javascript'></script>
<script src='citeproc-js/xmldom.js' type='text/javascript'></script>
<script src='citeproc-js/citeproc.js' type='text/javascript'></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src='lib/orcid.js' type='text/javascript'></script>
<script src='lib/styles.js' type='text/javascript'></script>

<script type="text/javascript">

var orcidID = "0000-0003-0902-4386";

$( document ).ready(function() {
	orcid.init(function(){
		orcid.resolveCitations(orcidID, doDownload, orcid.styleBibtex);
	});
});

function doDownload(citations){
	//compile into a single file and clean up html
	var text = "";
	for (c in citations){
		text += citations[c] +"\n";	
	}
	text = text.replace(/<div class="csl-entry">/g, '');
	text = text.replace(/<\/div>/g, '');
	var blob = new Blob([text], {type: 'text/plain'});

	//create a file that can be downloaded
	//this probably doesn't work in IE.
	var link = document.getElementById('downloadlink');
    link.href = window.URL.createObjectURL(blob);
    link.style.display = 'block';
}

</script>

<body>
  <h3>Building BibTeX, please wait...</h3>
  <a download="orcid.bib" id="downloadlink" style="display: none">Click to Download</a>
</body>